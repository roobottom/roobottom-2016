{% macro grid(columns,modifier,classes) %}
  <div class="grid{% if modifier %} grid--{{modifier}}{% endif %}{% if classes %} {{classes}}{% endif %}">
  {% for column in columns %}
    <div class="grid__column">
      {{ column }}
    </div>
  {% endfor %}
  </div>
{% endmacro %}

{% macro icon(name) %}
  <svg class="icon icon--{{name}}" aria-hidden="true">
    <use xlink:href="/icons.svg#{{name}}"/>
  </svg>
{% endmacro %}

{% macro c_block(items,pattern) %}
  {% if pattern %}
    {% for item in items %}
      {{ pattern(item) }}
    {% endfor %}
  {% else %}
    {% for item in items %}
      {{ item }}
    {% endfor %}
  {% endif %}
{% endmacro %}

{% macro c_siteBody(content) %}
  <main class="c_siteBody">
    {% for item in content %}
        {{ item }}
    {% endfor %}
  </main>
{% endmacro %}

{% macro c_siteHeader(items,active) %}
  <header class="c_siteHeader {% if active %}c_siteHeader--{{active}}{% endif %}">
    {% for item in items %}
    {{item}}
    {% endfor %}
  </header>
{% endmacro %}

{% macro c_wrapper(modules) %}
  <div class="c_wrapper">
    {% for module in modules %}
      {{ module }}
    {% endfor %}
  </div>
{% endmacro %}

{% macro m_cacheItem(post) %}
  <div class="m_cacheItem m_cacheItem--{{post.attributes.type}}">
    <h3>{{post.attributes.title}}</h3>
    <p><em>{{post.attributes.type}}</em>, <time datetime="{{post.attributes.date}}">{{post.attributes.date|date}}</time></p>
    {% if post.prev %}<p>
      <em>Prev: {{post.prev.title}}, {{post.prev.date|date}}, {{post.prev.type}}, {{post.prev.id}}</em>
    </p>{% endif %}
    {% if post.next %}<p>
      <em>Next: {{post.next.title}}, {{post.next.date|date}}, {{post.next.type}}, {{post.next.id}}</em>
    </p>{% endif %}
  </div>
{% endmacro %}

{% macro m_introduction(markdownFile) %}
  <div class="m_introduction">
    {% markdown markdownFile %}
  </div>
{% endmacro %}

{% macro m_gallery(images,type) %}
    <div class="m_gallery">
        {% for i in images %}
          <figure class="m_gallery__figure">
            <img src="{{site.imageServer}}r/600/600/{{type}}/{{ i.image }}" class="m_gallery__image"/>
            {% if i.caption %}
            <figcaption class="m_gallery__caption">{{ i.caption }}</figcaption>
            {% endif %}
          </figure>
        {% endfor %}
    </div>
{% endmacro %}

{% macro m_libraryBlock(text,markdown) %}
  <div class="m_libraryBlock type{% if markdown %} m_libraryBlock--markdown{% endif %}">
    {% if markdown %}
      {% markdown %}
      {{text}}
      {% endmarkdown %}
    {% else %}
      {{text}}
    {% endif %}
  </div>
{% endmacro %}

{% macro m_libraryDescription(text,markdown=true) %}
  {{text|dump|e}}
  {% if markdown == true %}
    <div class="m_libraryDescription type">
      {% markdown -%}{{text|e}}{%- endmarkdown %}
    </div>
  {% else %}
    <div class="m_libraryDescription">
      {{text}}
    </div>
  {% endif %}
{% endmacro %}

{% import "./icons/icon.pattern" as icon %}
{% macro m_logo() %}
  <a href="/" class="m_logo" aria-label="Website logo">
    {{icon.icon('logo')}}
  </a>
{% endmacro %}

{% import "./icons/icon.pattern" as icon %}
{% macro m_navigation(items, active, modifier, classes) %}
<nav class="m_navigation{%if modifier %} m_navigation--{{modifier}}{% endif %}{%if classes %} {{classes}}{% endif %}">
    <ul class="m_navigation__items">
        {% for item in items -%}
        <li class="m_navigation__item{% if item.url == '/' %} m_navigation__item--homepage{% endif %}">
          <a href="{{item.url}}" class="m_navigation__link m_navigation__link--{{item.name|lower|replace(' ','-')}}{% if item.name|lower|replace(' ','-') == active %} m_navigation__link--is-active{% endif %}">
            {% if item.url == '/' -%}
              {{icon.icon('logo')}}
            {% else %}
              {{item.name|capitalize}}
            {%- endif %}
          </a>
        </li>
        {%- endfor %}
    </ul>
</nav>
{% endmacro %}

{% macro m_pageTitle(title,date) %}
<h1 class="m_pageTitle">{{title|capitalize}}</h1>
{% if date %}
<time datetime="{{date}}" class="m_pageTitle__date">{{date | date}}</time>
{% endif %}
{% endmacro %}

{% macro m_patternBlock(description,code) %}
  <div class="m_patternBlock">
    <div class="m_patternBlock__description">{{description}}</div>
    <div class="m_patternBlock__code">{{code}}</div>
  </div>
{% endmacro %}

{% macro m_postArticle(post,heading,link,trimPost=false,active) %}
  <article class="m_post m_post--article type{% if active %} type--{{active}}{% endif %}">
    <{{heading}}>
      {% if link %}
        <a href="/articles/{{post.attributes.id}}">{{post.attributes.title}}</a>
      {% else %}
        {{post.attributes.title}}
      {% endif %}
    </{{heading}}>
    <time datetime="{{post.attributes.date}}">{{post.attributes.date | date}}</time>
    <div class="m_postarticles__body type">
      {% if trimPost %}
        {{post.html_body | safe | truncate(200) }}
      {% else %}
        {{post.html_body | safe }}
      {% endif %}
    </div>
  </article>
{% endmacro %}

{% macro title() %}
  <h1 class="m_postGallery__title">{{ post.attributes.title }}</h1>
  <time datetime="{{post.attributes.date}}" class="m_postGallery__date">{{post.attributes.date | date}}</time>
{% endmacro %}

{% macro body() %}
  <div class="m_postGallery__body type">
    {{post.html_body}}
  </div>
{% endmacro %}

{% macro m_postGallery(post) %}
  <article class="m_postGallery">

    {{
      grid([
        title()
      ],'prose')
    }}
    {{ m_gallery(post.attributes.images,'gallery') }}
    {{
      grid([
        body()
      ],'prose')
    }}

  </article>
{% endmacro %}

{% macro m_postNote(post) %}
  <article class="m_postNote">
    {% if post.attributes.images %}
      <div class="m_postNote__gallery">
        {{ m_gallery(post.attributes.images,'notes') }}
      </div>
    {% endif %}
    <div class="m_postNote__body type">
      {{post.html_body}}
    </div>
  </article>
{% endmacro %}

{% macro m_posts (posts,heading="h2",link=true,limit=10) %}
  {% for post in posts|limitTo(limit) %}
    {% if post.attributes.type == 'articles' %}
      {{ m_postarticles (post,heading,link) }}
    {% endif %}
    {% if post.attributes.type == 'gallery' %}
      {{ m_postGallery (post) }}
    {% endif %}
    {% if post.attributes.type == 'notes' %}
      {{ m_postNote(post) }}
    {% endif %}
  {% endfor %}
{% endmacro %}

{% macro m_postArticlesSummary (posts,heading="h2",link=true,limit=10) %}
  {% for post in posts | filterByType('articles') | limitTo(limit) %}
      {{ m_postArticles (post,heading,link,true) }}
  {% endfor %}
{% endmacro %}

{% macro m_postNotesSummary (posts,heading="h2",link=true,limit=10) %}
  {% for post in posts | filterByType('notes') | limitTo(limit) %}
      {{ m_postNote (post,heading,link) }}
  {% endfor %}
{% endmacro %}

{% macro m_postGallerySummary (posts,heading="h2",link=true,limit=10) %}
  {% for post in posts | filterByType('gallery') | limitTo(limit) %}
      {{ m_postGallery (post) }}
  {% endfor %}
{% endmacro %}

{% macro m_teaser(posts,hLevel='2',classes) %}
  {% for post in posts %}
  <article class="m_teaser m_teaser--{{post.attributes.type}}{% if classes %} {{classes}}{% endif %}">
    {% if post.attributes.images %}
      {% for image in post.attributes.images %}
        {% if loop.first %}
          <a href="/{{post.attributes.type}}/{{post.attributes.id}}">
            <img src="{{site.imageServer}}r/900/auto/{{post.attributes.type}}/{{image.image}}" alt="{{title}}" class="m_teaser__image"/>
          </a>
        {% endif %}
      {% endfor %}
    {% endif %}
    <div class="m_teaser__description m_teaser__description--{% if not post.attributes.images %}no-image{% else %}has-image{% endif %}">
      <div class="m_teaser__type">{{post.attributes.type}}</div>
      <h{{hLevel}} class="m_teaser__title"><a href="/{{post.attributes.type}}/{{post.attributes.id}}" class="m_teaser__link">{{post.attributes.title}}</a></h{{hLevel}}>
      <time class="m_teaser__date" datetime="{{post.attributes.date}}">{{post.attributes.date|date}}</time>
      <div class="m_teaser__summary type">
        {{post.html_body  | stripPatterns}}
      </div>
    </div>
  </article>
  {% endfor %}
{% endmacro %}
